# Test Plan: User Authentication & Language Selection

## 1. Introduction

### 1.1 Purpose
This document outlines the test plan for the **User Authentication & Language Selection** feature of the AgriConnect platform. The purpose of this plan is to detail the scope, approach, resources, and schedule of intended test activities. It identifies the features to be tested, the testing tasks to be performed, the personnel responsible for each task, the risks associated with the plan, and the criteria for successful completion of testing. This document will ensure that the feature meets the specified requirements and quality standards before deployment.

### 1.2 Scope of Testing
The scope of this test plan covers the functional and non-functional testing of the User Authentication & Language Selection feature as defined in the Feature Overview Specification and High-Level Architecture documents. This includes:
*   Language selection and persistence for both unauthenticated and authenticated users.
*   User registration via Email/Password, Google, and Phone Number.
*   User login via Email/Password, Google, and Phone Number.
*   Secure storage and retrieval of user preferences and authentication details.
*   UI responsiveness and localization accuracy.
*   Usability, accessibility, performance, and security aspects related to this feature.

## 2. References
*   Feature Overview Specification: [`docs/specs/UserAuthentication_LanguageSelection_overview.md`](docs/specs/UserAuthentication_LanguageSelection_overview.md)
*   High-Level Architecture: [`docs/architecture/UserAuthentication_LanguageSelection_architecture.md`](docs/architecture/UserAuthentication_LanguageSelection_architecture.md)
*   AgriConnect User Blueprint (PRD): [`docs/PRD.md`](docs/PRD.md)

## 3. Test Strategy

### 3.1 Test Levels & Types
A multi-layered testing approach will be adopted:

*   **Unit Testing**: Developers will perform unit testing on individual components and functions, particularly for UI components (`LanguageSwitcher`), API route handlers, and utility functions related to language preference management and Supabase interactions. Mocking will be used for external dependencies like Clerk and Supabase SDKs.
*   **Integration Testing**: Focus will be on testing the interactions between components, such as:
    *   UI components interacting with `next-intl` for translations.
    *   Frontend components interacting with Clerk SDK for authentication.
    *   Next.js API routes/server actions interacting with Supabase for profile data.
    *   Clerk webhook handling and Supabase profile synchronization.
*   **System/End-to-End (E2E) Testing**: Simulates real user scenarios from start to finish. This will cover complete user flows like:
    *   New user selecting a language, registering, and verifying language persistence.
    *   Existing user logging in, changing language, and verifying persistence.
    *   Authentication flows across different methods.
    *   Automated E2E tests will be developed using a framework like Playwright or Cypress.
*   **Usability Testing**: Manual testing to evaluate the ease of use, intuitiveness of the language switcher, and clarity of the authentication process. Feedback will be gathered on UI/UX aspects.
*   **Accessibility Testing**: Manual and automated checks (e.g., Axe DevTools) to ensure compliance with WCAG AA guidelines for language switcher and authentication forms, focusing on keyboard navigation and screen reader compatibility.
*   **Performance Testing**:
    *   Measure UI update time after language switching (target < 1 second).
    *   Measure authentication response times (target < 3 seconds).
    *   Basic load testing on authentication endpoints if feasible.
*   **Security Testing**:
    *   Verify secure handling of user credentials by Clerk.
    *   Verify RLS policies in Supabase for user profile data.
    *   Check for common web vulnerabilities (e.g., XSS, CSRF) on custom UI elements, although Clerk components are expected to be secure.
    *   Verify webhook signature validation.
*   **Localization Testing**: Verify that all UI text (labels, buttons, messages) is correctly translated and displayed for supported languages (Hindi, Marathi, English). Check for text overflow or layout issues with different languages.

### 3.2 Test Environments
*   **Development**: Local developer machines with mocked services.
*   **Staging/Testing**: A dedicated environment mirroring production as closely as possible, integrated with staging instances of Clerk and Supabase. This will be the primary environment for E2E, Usability, Accessibility, Performance, and Security testing.
*   **Production**: Post-deployment sanity checks.

### 3.3 Test Data Requirements
*   **User Accounts**:
    *   New user accounts for registration testing (Email/Password, Google, Phone).
    *   Existing user accounts with different pre-set language preferences.
    *   Test Google accounts.
    *   Test phone numbers for OTP verification (may require a test service).
*   **Language Data**:
    *   Localization files (`en.json`, `hi.json`, `mr.json`) with accurate translations.
*   **Invalid Data**:
    *   Incorrect credentials (email, password, OTP).
    *   Invalid email formats, phone numbers.

### 3.4 Entry Criteria
*   Feature development is complete and deployed to the test environment.
*   All referenced documents (spec, architecture) are stable.
*   Unit tests are completed and passing.
*   Test environment is set up and accessible.
*   Test data is prepared.

### 3.5 Exit Criteria
*   All planned test cases are executed.
*   A high percentage of test cases passed (e.g., 100% for critical & high priority, 95% for medium).
*   No outstanding critical or high-priority defects.
*   All major defects are fixed and retested.
*   Test summary report is approved.
*   Requirements traceability matrix shows full coverage.

## 4. Test Scope

### 4.1 Features to be Tested
Based on Functional Requirements (FR), User Stories (US), and Acceptance Criteria (AC) from [`docs/specs/UserAuthentication_LanguageSelection_overview.md`](docs/specs/UserAuthentication_LanguageSelection_overview.md):

*   **Language Selection & Persistence (FR1, FR2, FR3, FR4, US1, US2, US5, AC1, AC2, AC3)**
    *   Display and functionality of the language switcher.
    *   Initial language detection (URL, cookie, browser header, default).
    *   Language selection for unauthenticated users and persistence via cookie/local storage.
    *   Language selection for authenticated users and persistence in Supabase user profile.
    *   Dynamic UI updates upon language change across the application.
*   **User Registration (FR5, FR6, FR7, FR8, FR9, US3, US6, AC4, AC5, AC6)**
    *   Registration via Email/Password.
    *   Registration via Google OAuth.
    *   Registration via Phone Number (OTP).
    *   Secure storage of authentication details (by Clerk).
    *   Synchronization of `clerk_user_id` and `preferred_language` to Supabase `user_profiles` table upon registration.
    *   Registration forms and messages displayed in the selected UI language.
    *   Error handling for registration failures.
*   **User Login (FR5, FR6, FR7, FR8, FR9, US4, US6, AC7, AC8)**
    *   Login via Email/Password.
    *   Login via Google OAuth.
    *   Login via Phone Number.
    *   Retrieval and application of stored language preference upon login.
    *   Login forms and messages displayed in the selected UI language.
    *   Error handling for login failures (invalid credentials, etc.).
*   **Profile Language Storage (FR7, AC10, DR1)**
    *   Verification of `preferred_language` field in Supabase `user_profiles` table.
*   **Non-Functional Requirements Testing**
    *   **Security (NFR1)**: Secure authentication, data privacy, password hashing (via Clerk).
    *   **Usability (NFR2, UIX1-UIX8)**: Intuitive language switcher, simple auth process, clear UI.
    *   **Accessibility (NFR3)**: Keyboard navigation, screen reader compatibility for language switcher and auth forms.
    *   **Performance (NFR4)**: Language switch speed, auth response time.
    *   **Maintainability (NFR5)**: Structure of localization files (manual review).
    *   **Responsiveness (NFR6)**: UI elements on various devices/screen sizes.
    *   **Extensibility (NFR7)**: Architectural review for ease of adding new languages.

### 4.2 Features Not to be Tested (Out of Scope for this feature iteration)
*   Support for languages beyond Hindi, Marathi, English.
*   Complex profile management beyond basic info and language preference.
*   Role-based access control (RBAC) beyond basic authenticated/unauthenticated.
*   Two-factor authentication (2FA) beyond Clerk's default provisions for chosen methods.
*   Full UI localization for dynamic, user-generated content.

## 5. Test Cases
Test cases will be derived from the User Stories, Functional Requirements, Non-Functional Requirements, and Acceptance Criteria. Each test case will include: Test Case ID, Test Case Description, Preconditions, Test Steps, Expected Results, Actual Results, Status (Pass/Fail), Priority (Critical, High, Medium, Low), Test Type, and associated Requirement ID(s).

A detailed list of test cases will be maintained in a separate test case management tool or document. Below are examples of test case categories and specific test cases.

**Total Test Cases (Estimated):**
*   Language Selection & UI: ~25-30
*   User Registration: ~30-35 (covering 3 methods, various scenarios)
*   User Login: ~25-30 (covering 3 methods, various scenarios)
*   Profile & Data: ~5-10
*   Non-Functional (Usability, Accessibility, Performance, Security): ~20-25
*   **Overall Estimated Test Cases: 105 - 130**

---

### 5.1 Language Selection and UI

| TC ID    | Description                                                                 | Preconditions                                                              | Steps                                                                                                                                                                                                                            | Expected Results                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       RY_TERREUser Authentication & Language Selection Test Plan

## Test Plan for UserAuthentication_LanguageSelection Feature

**Feature Name**: UserAuthentication_UserAuthentication_LanguageSelection
**Output Path**: `docs/testplans/UserAuthentication_UserAuthentication_UserAuthentication_LanguageSelection_testplan.md`

## 1. Introduction

### 1.1 Purpose
This document outlines the test plan for the User Authentication & Language Selection feature of the AgriConnect platform. This plan details the scope, approach, resources, and schedule of intended test activities to ensure the feature meets specified requirements and quality standards.

### 1.2 Scope of Testing
This test plan covers functional and non-functional testing of the User Authentication & Language Selection feature as defined in the Feature Overview Specification and High-Level Architecture documents. This includes language selection, user registration, user login, secure storage of user preferences, UI responsiveness, localization accuracy, usability, accessibility, performance, and security aspects.

## 2. References
*   Feature Overview Specification: [`docs/specs/UserAuthentication_LanguageSelection_overview.md`](docs/specs/UserAuthentication_LanguageSelection_overview.md)
*   High-Level Architecture: [`docs/architecture/UserAuthentication_LanguageSelection_architecture.md`](docs/architecture/UserAuthentication_LanguageSelection_architecture.md)
*   AgriConnect User Blueprint (PRD): [`docs/PRD.md`](docs/PRD.md)

## 3. Test Strategy

### 3.1 Test Levels & Types
*   **Unit Testing**: Developers will perform unit testing on individual components and functions.
*   **Integration Testing**: Focus on interactions between components like UI with `next-intl`, frontend with Clerk SDK, and Next.js API routes/server actions with Supabase.
*   **System/End-to-End (E2E) Testing**: Simulate real user scenarios covering complete user flows.
*   **Usability Testing**: Manual testing to evaluate ease of use and intuitiveness.
*   **Accessibility Testing**: Manual and automated checks for WCAG AA compliance.
*   **Performance Testing**: Measure UI update time after language switching and authentication response times.
*   **Security Testing**: Verify secure handling of credentials, RLS policies, and common web vulnerabilities.
*   **Localization Testing**: Verify correct translation and display for supported languages.

### 3.2 Test Environments
*   **Development**: Local developer machines with mocked services.
*   **Staging/Testing**: Dedicated environment mirroring production, integrated with staging instances of Clerk and Supabase.
*   **Production**: Post-deployment sanity checks.

### 3.3 Test Data Requirements
*   New and existing user accounts with various language preferences.
*   Test Google accounts and phone numbers for OTP.
*   Localization files (`en.json`, `hi.json`, `mr.json`).
*   Invalid data for negative testing.

### 3.4 Entry Criteria
*   Feature development complete and deployed to the test environment.
*   Stable referenced documents.
*   Unit tests completed and passing.
*   Test environment set up and accessible.
*   Test data prepared.

### 3.5 Exit Criteria
*   All planned test cases executed.
*   High percentage of test cases passed (100% for critical & high priority, 95% for medium).
*   No outstanding critical or high-priority defects.
*   Major defects fixed and retested.
*   Test summary report approved.
*   Requirements traceability matrix shows full coverage.

## 4. Test Scope

### 4.1 Features to be Tested
*   Language Selection & Persistence (FR1, FR2, FR3, FR4, US1, US2, US5, AC1, AC2, AC3)
*   User Registration (FR5, FR6, FR7, FR8, FR9, US3, US6, AC4, AC5, AC6)
*   User Login (FR5, FR6, FR7, FR8, FR9, US4, US6, AC7, AC8)
*   Profile Language Storage (FR7, AC10, DR1)
*   Non-Functional Requirements (Security, Usability, Accessibility, Performance, Responsiveness)

### 4.2 Features Not to be Tested
*   Support for languages beyond Hindi, Marathi, English.
*   Complex profile management beyond basic info and language preference.
*   Role-based access control (RBAC) beyond basic authenticated/unauthenticated.
*   Two-factor authentication (2FA) beyond Clerk's default provisions.
*   Full UI localization for dynamic, user-generated content.

## 5. Test Cases

A detailed list of test cases will be maintained separately. The following sections outline the categories and provide representative examples.

### 5.1 Language Selection & UI (Approx. 25-30 Test Cases)

| Test Case ID | Description                                                                                                | Priority | Type     | Requirement(s)                               |
|--------------|------------------------------------------------------------------------------------------------------------|----------|----------|----------------------------------------------|
| LS_UI_001    | Verify language switcher is visible and offers Hindi, Marathi, English on initial visit.                     | Critical | Positive | FR1, FR2, US1, AC1, UIX1                     |
| LS_UI_002    | Verify UI updates to Hindi when "Hindi" is selected by a new user.                                           | Critical | Positive | FR4, US1, AC1                                |
| LS_UI_003    | Verify UI remains in Hindi when navigating to other pages after selecting Hindi (unauthenticated).           | High     | Positive | FR3, US1, AC1                                |
| LS_UI_004    | Verify language preference (e.g., Marathi) persists for unauthenticated user after closing and reopening browser. | High     | Positive | FR3, US5, AC2                                |
| LS_UI_005    | Verify authenticated user can change language preference (e.g., English to Hindi) in account settings.       | Critical | Positive | FR3, US2, AC3                                |
| LS_UI_006    | Verify UI updates immediately after authenticated user changes language preference.                          | High     | Positive | FR4, AC3                                     |
| LS_UI_007    | Verify authenticated user's changed language preference (e.g., Hindi) persists after logout and login.       | Critical | Positive | FR3, US5, AC3                                |
| LS_UI_008    | Verify initial language detection based on URL path (e.g., `/hi/`).                                          | High     | Positive | `i18nMiddleware`                             |
| LS_UI_009    | Verify initial language detection based on `NEXT_LOCALE` cookie.                                             | High     | Positive | `i18nMiddleware`                             |
| LS_UI_010    | Verify initial language detection based on `Accept-Language` browser header.                                 | Medium   | Positive | `i18nMiddleware`                             |
| LS_UI_011    | Verify fallback to default language (English) if no preference is detected.                                | Medium   | Positive | `i18nMiddleware`                             |
| LS_UI_012    | Verify language switcher functionality on different screen sizes (responsive design).                        | High     | Positive | NFR6, UIX4                                   |
| LS_UI_013    | Verify all static UI elements (menus, buttons, labels) are translated correctly in English.                  | High     | Positive | FR4, NFR5                                    |
| LS_UI_014    | Verify all static UI elements (menus, buttons, labels) are translated correctly in Hindi.                    | High     | Positive | FR4, NFR5                                    |
| LS_UI_015    | Verify all static UI elements (menus, buttons, labels) are translated correctly in Marathi.                  | High     | Positive | FR4, NFR5                                    |
| LS_UI_016    | Verify no text overflow or layout issues with Hindi translations.                                            | Medium   | Positive | NFR2, NFR5                                   |
| LS_UI_017    | Verify no text overflow or layout issues with Marathi translations.                                          | Medium   | Positive | NFR2, NFR5                                   |
| LS_UI_018    | Verify language switcher is accessible via keyboard navigation.                                              | High     | Positive | NFR3, NFR2                                   |
| LS_UI_019    | Verify language switcher is compatible with screen readers.                                                  | High     | Positive | NFR3                                         |
| LS_UI_020    | Verify prominent display of language selection for first-time visitors (e.g., modal or visible section).   | Medium   | Positive | UIX8                                         |

### 5.2 User Registration (Approx. 30-35 Test Cases)

| Test Case ID | Description                                                                                             | Priority | Type     | Requirement(s)                               |
|--------------|---------------------------------------------------------------------------------------------------------|----------|----------|----------------------------------------------|
| REG_EP_001   | Verify successful registration with valid Email/Password (English UI).                                    | Critical | Positive | FR5, FR6, US3, AC4                           |
| REG_EP_002   | Verify user is logged in after successful Email/Password registration.                                    | Critical | Positive | AC4                                          |
| REG_EP_003   | Verify confirmation message is displayed in English after Email/Password registration.                    | High     | Positive | FR8, AC4                                     |
| REG_EP_004   | Verify error message for existing email during Email/Password registration (Hindi UI).                    | High     | Negative | FR9, AC9                                     |
| REG_EP_005   | Verify error message for password mismatch during Email/Password registration (Marathi UI).               | High     | Negative | FR9, AC9                                     |
| REG_EP_006   | Verify error message for weak password during Email/Password registration.                                | High     | Negative | FR9, NFR1                                    |
| REG_EP_007   | Verify registration form labels and buttons are in the selected language (e.g., Hindi).                   | High     | Positive | FR8, AC9                                     |
| REG_GO_001   | Verify successful registration/login with a new Google account.                                           | Critical | Positive | FR5, FR6, US3, AC5                           |
| REG_GO_002   | Verify user is logged in after successful Google registration.                                            | Critical | Positive | AC5                                          |
| REG_GO_003   | Verify registration with an existing Google account (should log in).                                      | High     | Positive | US4, AC5                                     |
| REG_PH_001   | Verify successful registration with a valid phone number and OTP (English UI).                            | Critical | Positive | FR5, FR6, US3, AC6                           |
| REG_PH_002   | Verify user is logged in after successful phone number registration.                                      | Critical | Positive | AC6                                          |
| REG_PH_003   | Verify error message for invalid phone number format (Hindi UI).                                          | High     | Negative | FR9, AC9                                     |
| REG_PH_004   | Verify error message for incorrect OTP during phone registration (Marathi UI).                            | High     | Negative | FR9, AC9                                     |
| REG_PH_005   | Verify OTP resend functionality.                                                                          | Medium   | Positive | FR6                                          |
| REG_ALL_001  | Verify `clerk_user_id` and initial `preferred_language` are stored in Supabase `user_profiles` after new Email/Password registration. | Critical | Positive | FR7, AC10, DR1, Arch 4.2                     |
| REG_ALL_002  | Verify `clerk_user_id` and initial `preferred_language` are stored in Supabase `user_profiles` after new Google registration. | Critical | Positive | FR7, AC10, DR1, Arch 4.2                     |
| REG_ALL_003  | Verify `clerk_user_id` and initial `preferred_language` are stored in Supabase `user_profiles` after new Phone registration. | Critical | Positive | FR7, AC10, DR1, Arch 4.2                     |
| REG_ALL_004  | Verify registration process is simple and straightforward.                                                | High     | Positive | NFR2                                         |
| REG_ALL_005  | Verify registration forms are responsive on mobile devices.                                               | High     | Positive | NFR6, UIX4                                   |

### 5.3 User Login (Approx. 25-30 Test Cases)

| Test Case ID | Description                                                                                             | Priority | Type     | Requirement(s)                               |
|--------------|---------------------------------------------------------------------------------------------------------|----------|----------|----------------------------------------------|
| LOG_EP_001   | Verify successful login with correct Email/Password (Marathi UI).                                         | Critical | Positive | FR5, US4, AC7                                |
| LOG_EP_002   | Verify UI is displayed in user's saved preferred language (e.g., Marathi) after Email/Password login.     | Critical | Positive | FR3, US5, AC7                                |
| LOG_EP_003   | Verify error message for incorrect password with Email/Password login (Hindi UI).                         | Critical | Negative | FR9, AC8, AC9                                |
| LOG_EP_004   | Verify error message for non-existent email with Email/Password login (English UI).                       | Critical | Negative | FR9, AC8                                     |
| LOG_EP_005   | Verify login form labels and buttons are in the selected language (e.g., Marathi).                        | High     | Positive | FR8, AC9                                     |
| LOG_GO_001   | Verify successful login with an existing Google account.                                                  | Critical | Positive | FR5, US4, AC5 (implicitly)                   |
| LOG_GO_002   | Verify UI is displayed in user's saved preferred language after Google login.                             | Critical | Positive | FR3, US5                                     |
| LOG_PH_001   | Verify successful login with an existing Phone number and OTP.                                            | Critical | Positive | FR5, US4, AC6 (implicitly)                   |
| LOG_PH_002   | Verify UI is displayed in user's saved preferred language after Phone login.                              | Critical | Positive | FR3, US5                                     |
| LOG_PH_003   | Verify error message for incorrect OTP during phone login.                                                | High     | Negative | FR9                                          |
| LOG_ALL_001  | Verify session persistence after successful login (e.g., refresh page, close/reopen tab).                 | High     | Positive | US5                                          |
| LOG_ALL_002  | Verify login process is simple and straightforward.                                                       | High     | Positive | NFR2                                         |
| LOG_ALL_003  | Verify login forms are responsive on tablet devices.                                                      | High     | Positive | NFR6, UIX4                                   |
| LOG_ALL_004  | Verify logout functionality.                                                                              | Critical | Positive | -                                            |
| LOG_ALL_005  | Verify after logout, user is redirected appropriately and language reverts to non-authenticated state (e.g. cookie or default). | High | Positive | FR3                                          |

### 5.4 Profile and Data (Approx. 5-10 Test Cases)

| Test Case ID | Description                                                                                             | Priority | Type     | Requirement(s)                               |
|--------------|---------------------------------------------------------------------------------------------------------|----------|----------|----------------------------------------------|
| PD_001       | Verify `preferred_language` in Supabase `user_profiles` table is updated when an authenticated user changes language. | Critical | Positive | FR3, FR7, AC10, DR1, Arch 4.4                |
| PD_002       | Verify `clerk_user_id` is correctly stored and links to Clerk user.                                       | Critical | Positive | FR7, DR1, Arch 4.2                           |
| PD_003       | Verify `created_at` and `updated_at` timestamps are correctly managed in `user_profiles`.                 | Medium   | Positive | DR1                                          |
| PD_004       | Verify webhook `user.created` from Clerk successfully triggers profile creation in Supabase.              | High     | Positive | Arch 4.2, Arch 5.1, Arch 10                  |
| PD_005       | Verify webhook `user.updated` from Clerk successfully triggers profile update in Supabase (if applicable for fields like name/email). | Medium | Positive | Arch 10                                      |

### 5.5 Non-Functional Testing (Approx. 20-25 Test Cases)

#### 5.5.1 Usability

| Test Case ID | Description                                                                                             | Priority | Type     | Requirement(s)                               |
|--------------|---------------------------------------------------------------------------------------------------------|----------|----------|----------------------------------------------|
| USAB_001     | Verify language switcher is intuitive and easy to find/use.                                               | High     | Positive | NFR2, UIX1                                   |
| USAB_002     | Verify registration process is clear, with minimal steps.                                                 | High     | Positive | NFR2, US6, UIX2                              |
| USAB_003     | Verify login process is straightforward.                                                                  | High     | Positive | NFR2, US6, UIX2                              |
| USAB_004     | Verify error messages are clear, understandable, and displayed in the selected language.                  | High     | Positive | FR9, NFR2, UIX3                              |
| USAB_005     | Verify visual feedback (loading indicators) during language switch and authentication.                    | Medium   | Positive | UIX3                                         |
| USAB_006     | Verify UI is clean, uncluttered, with high-contrast text and buttons.                                     | Medium   | Positive | NFR2, UIX7                                   |

#### 5.5.2 Accessibility

| Test Case ID | Description                                                                                             | Priority | Type     | Requirement(s)                               |
|--------------|---------------------------------------------------------------------------------------------------------|----------|----------|----------------------------------------------|
| ACC_001      | Verify language switcher is fully operable using keyboard only.                                           | High     | Positive | NFR3                                         |
| ACC_002      | Verify authentication forms (login, registration) are fully operable using keyboard only.                 | High     | Positive | NFR3                                         |
| ACC_003      | Verify language switcher elements have appropriate ARIA attributes for screen readers.                    | High     | Positive | NFR3                                         |
| ACC_004      | Verify authentication form fields and buttons have appropriate ARIA attributes for screen readers.        | High     | Positive | NFR3                                         |
| ACC_005      | Verify color contrast ratios meet WCAG AA for text and UI elements in auth/language sections.             | Medium   | Positive | NFR3, NFR2                                   |

#### 5.5.3 Performance

| Test Case ID | Description                                                                                             | Priority | Type     | Requirement(s)                               |
|--------------|---------------------------------------------------------------------------------------------------------|----------|----------|----------------------------------------------|
| PERF_001     | Measure UI update time after selecting a new language.                                                    | High     | Positive | NFR4                                         |
| PERF_002     | Measure response time for Email/Password registration.                                                    | High     | Positive | NFR4                                         |
| PERF_003     | Measure response time for Email/Password login.                                                           | High     | Positive | NFR4                                         |
| PERF_004     | Measure response time for Google OAuth registration/login.                                                | High     | Positive | NFR4                                         |
| PERF_005     | Measure response time for Phone Number OTP registration/login.                                            | High     | Positive | NFR4                                         |

#### 5.5.4 Security

| Test Case ID | Description                                                                                             | Priority | Type     | Requirement(s)                               |
|--------------|---------------------------------------------------------------------------------------------------------|----------|----------|----------------------------------------------|
| SEC_001      | Verify user passwords are not stored in plain text (Responsibility of Clerk, verify no local leakage).    | Critical | Positive | NFR1                                         |
| SEC_002      | Verify session management is secure (e.g., HttpOnly cookies used by Clerk).                               | Critical | Positive | NFR1, Arch 8                                 |
| SEC_003      | Verify Supabase RLS policies prevent unauthorized access/modification of `user_profiles` data.            | Critical | Positive | NFR1, Arch 5.2, Arch 7                       |
| SEC_004      | Verify Clerk webhook endpoint (`/api/clerk-webhooks/sync-user-profile`) validates webhook signatures.     | Critical | Positive | Arch 8, Arch 10                              |
| SEC_005      | Verify API endpoint for language update (`/api/user/profile/language`), if used, is protected by auth.   | Critical | Positive | Arch 8, Arch 10                              |
| SEC_006      | Test for common XSS vulnerabilities in any custom input fields related to language or profile (if any).   | High     | Negative | NFR1                                         |
| SEC_007      | Test for CSRF vulnerabilities if custom forms are used for language preference changes.                   | High     | Negative | NFR1                                         |

#### 5.5.5 Responsiveness

| Test Case ID | Description                                                                                             | Priority | Type     | Requirement(s)                               |
|--------------|---------------------------------------------------------------------------------------------------------|----------|----------|----------------------------------------------|
| RESP_001     | Verify language switcher displays and functions correctly on mobile viewport (e.g., 360px width).         | High     | Positive | NFR6, UIX4                                   |
| RESP_002     | Verify registration forms display and function correctly on mobile viewport.                              | High     | Positive | NFR6, UIX4                                   |
| RESP_003     | Verify login forms display and function correctly on mobile viewport.                                     | High     | Positive | NFR6, UIX4                                   |
| RESP_004     | Verify language switcher displays and functions correctly on tablet viewport (e.g., 768px width).         | High     | Positive | NFR6, UIX4                                   |
| RESP_005     | Verify registration forms display and function correctly on tablet viewport.                              | High     | Positive | NFR6, UIX4                                   |
| RESP_006     | Verify login forms display and function correctly on tablet viewport.                                     | High     | Positive | NFR6, UIX4                                   |

---

## 6. Test Environment Requirements

*   **Browsers**: Latest versions of Chrome, Firefox, Safari, Edge.
*   **Mobile Devices/Emulators**: iOS (latest version on representative iPhone), Android (latest version on representative Android device).
*   **Operating Systems**: Windows, macOS, Linux (for browser testing).
*   **Tools**:
    *   Browser developer tools.
    *   Accessibility testing tools (e.g., Axe DevTools).
    *   Performance testing tools (e.g., Lighthouse, browser performance profiler).
    *   API testing tool (e.g., Postman, Insomnia) for webhook and API endpoint verification.
    *   Test management tool (if used).
    *   E2E automation framework (e.g., Playwright/Cypress).
*   **Network Conditions**: Test under various simulated network conditions (e.g., fast, slow 3G) for performance and usability.
*   **Integrations**: Access to configured Clerk development/staging instance and Supabase development/staging instance.

## 7. Test Data Management
*   Test data will be created manually or scripted as needed.
*   Sensitive test data (like credentials) will be managed securely.
*   Data will be reset or cleaned up between test runs where necessary to ensure test independence.
*   For OTP testing with phone numbers, a pool of test numbers or a service that provides temporary numbers might be required if Clerk's test mode doesn't fully cover this.

## 8. Risks and Mitigation

| Risk ID | Risk Description                                                                 | Likelihood | Impact | Mitigation Strategy                                                                                                                               |
|---------|----------------------------------------------------------------------------------|------------|--------|---------------------------------------------------------------------------------------------------------------------------------------------------|
| R01     | Incomplete or inaccurate translations in localization files.                     | Medium     | Medium | Thorough review of translation files by language experts/reviewers. Implement a process for updating translations.                                |
| R02     | Issues with Clerk integration (e.g., webhook failures, SDK misconfiguration).    | Medium     | High   | Early integration testing. Close monitoring of Clerk dashboard and logs. Refer to Clerk documentation for troubleshooting.                          |
| R03     | Issues with Supabase integration (e.g., RLS misconfiguration, connection issues). | Medium     | High   | Thorough testing of RLS policies. Verify Supabase client configurations. Monitor Supabase logs.                                                   |
| R04     | Performance bottlenecks in language switching or authentication.                 | Low        | Medium | Conduct performance testing early. Optimize client-side rendering and API calls if issues are found.                                              |
| R05     | Accessibility issues not caught by automated tools.                              | Medium     | Medium | Supplement automated testing with manual accessibility reviews by testers familiar with WCAG guidelines. Use screen readers for validation.        |
| R06     | Security vulnerabilities in custom code or integration points.                   | Medium     | High   | Conduct security-focused code reviews. Perform penetration testing if possible. Adhere to security best practices for webhooks and API endpoints. |
| R07     | Test environment setup delays or instability.                                    | Medium     | Medium | Plan environment setup in advance. Have dedicated personnel for environment maintenance.                                                            |
| R08     | Limited availability of diverse test devices for responsiveness testing.         | Low        | Medium | Utilize browser emulation tools extensively. Prioritize testing on most common device types based on analytics (if available).                  |
| R09     | Inconsistencies in language preference handling across different states (cookie, Supabase, Clerk session). | Medium | Medium | Detailed test cases for state transitions and persistence. Clear architectural design for preference hierarchy.                               |

## 9. Test Deliverables
*   **Test Plan Document (this document)**.
*   **Test Case Document/Suite**: Detailed test cases with steps and expected results.
*   **Test Data**: Set of data used for testing.
*   **Test Execution Logs**: Record of executed test cases and their outcomes.
*   **Defect Reports**: Detailed reports for all identified defects, tracked in a bug tracking system.
*   **Test Summary Report**: A comprehensive report summarizing testing activities, results, defect status, coverage, and overall quality assessment of the feature.
*   **Requirements Traceability Matrix**: Mapping test cases back to requirements.

## 10. Staffing and Responsibilities
*   **Test Lead/Manager**: Overall responsibility for test planning, execution, and reporting.
*   **QA Engineers/Testers**: Test case design, execution, defect reporting, retesting.
*   **Developers**: Unit testing, defect fixing, support for QA team.
*   **DevOps/Infrastructure Team**: Test environment setup and maintenance.
*   **(Optional) Business Analyst/Product Owner**: UAT, review of test cases for business logic coverage.

## 11. Schedule (High-Level)
*   **Test Planning**: [Start Date] - [End Date]
*   **Test Case Design**: [Start Date] - [End Date]
*   **Test Environment Setup & Data Preparation**: [Start Date] - [End Date]
*   **Test Execution (Cycle 1)**: [Start Date] - [End Date]
*   **Defect Fixing & Retesting (Cycle 1)**: [Start Date] - [End Date]
*   **Test Execution (Cycle 2 - Regression)**: [Start Date] - [End Date]
*   **Performance & Security Testing**: [Start Date] - [End Date]
*   **Accessibility & Usability Testing**: [Start Date] - [End Date]
*   **Test Reporting & Sign-off**: [Start Date] - [End Date]

*(Specific dates to be filled in based on project timeline)*

This test plan provides a comprehensive framework for validating the User Authentication & Language Selection feature. It will be a living document and may be updated as the project progresses and more information becomes available.